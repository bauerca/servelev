<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>
    <p id="msg"></p>

    <form>
        <label>N </label><input type="text" name="north"/>
        <label>W </label><input type="text" name="west"/>
        <label>dlng (dx): </label><input type="text" name="width"/>
        <label>dlat (dy): </label><input type="text" name="height"/>
        <button type="submit">Get</button>
    </form>

    <script>
        $(document).ready(function() {
            var ws = new WebSocket('ws://localhost:7631'),
                $msg = $('#msg'),
                $ta = $('textarea');

            ws.binaryType = 'arraybuffer';
            ws.onmessage = function(msg) {
                //$msg.text(msg.data);
                console.log(msg.data.byteLength);
                console.log(msg.data);

                var arr = new Float32Array(msg.data, 16); //, msg.data.byteLength - 16);
                for (var i = 0; i < arr.length; i++)
                    console.log(arr[i]);
            };

            ws.onerror = function(err) {
                console.log(err);
            };

            var fmtMap = {
                north: 0,
                west: 1,
                width: 2,
                height: 3
            };

            $('form').on('submit', function(ev) {
                console.log('sending...');
                var msg = {
                        bounds: {
                            format: 'NWwh',
                            values: [null, null, null, null]
                        },
                        resolution: 16
                    },
                    bounds = msg.bounds,
                    form;


                form = $(this).serializeArray();
                $.each(form, function(index, input) {
                    var i = fmtMap[input.name];
                    bounds.values[i] = parseFloat(input.value);
                });

                ev.preventDefault();
                //$msg.text(JSON.stringify(msg));
                ws.send(JSON.stringify(msg));
            });

        });
    </script>
</body>
</html>
